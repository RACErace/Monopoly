# 大富翁联机版 🎲

一个基于Web的多人联机大富翁游戏，支持2-6名玩家在线对战。

## 🎮 游戏特色

- **多人联机**：支持2-6名玩家实时在线对战
- **实时通信**：基于WebSocket实现实时游戏状态同步
- **精美界面**：响应式设计，支持桌面和移动设备
- **完整规则**：包含地块购买、升级、抵押、赎回等完整游戏机制
- **随机事件**：机遇卡和命运卡增加游戏趣味性
- **破产机制**：完整的财务管理和破产处理系统
- **连接监控**：实时监控玩家连接状态

## 🚀 快速开始

### 环境要求

- Python 3.8+
- 现代浏览器（Chrome、Firefox、Safari、Edge）

### 安装依赖

```bash
pip install fastapi uvicorn websockets
```

### 启动服务器

方式一：使用启动脚本（推荐）
```bash
python run-server.py
```

方式二：直接使用uvicorn
```bash
uvicorn server:app --reload --host 0.0.0.0 --port 8000
```

### 开始游戏

1. 打开浏览器访问：`http://localhost:8000`
2. 输入玩家名称并选择颜色
3. 等待其他玩家加入（2-6人）
4. 房主点击"开始游戏"按钮
5. 按顺序掷骰子，享受游戏！

## 🎯 游戏规则

### 基本玩法

1. **掷骰子**：轮流掷骰子移动
2. **购买地块**：踩到无主地块可以购买
3. **收取租金**：其他玩家踩到你的地块需要付租金
4. **升级地块**：在自己的地块上建造房屋增加租金
5. **随机事件**：踩到"机遇"或"命运"格子触发随机事件

### 高级功能

- **抵押地块**：缺钱时可以抵押地块获得资金
- **赎回地块**：有钱时可以赎回已抵押的地块
- **出售地块**：彻底出售地块给银行
- **破产处理**：资不抵债时自动处理破产流程

### 胜利条件

游戏继续进行直到只剩一名玩家未破产，该玩家获胜！

## 📁 项目结构

```
Monopoly/
├── game.py           # 游戏核心逻辑
├── server.py         # FastAPI服务器和WebSocket处理
├── run-server.py     # 服务器启动脚本
├── client.html       # 游戏客户端界面
├── monitor.html      # 连接监控页面
└── README.md         # 项目说明文档
```

## 🔧 技术架构

### 后端技术栈
- **FastAPI**：高性能Web框架
- **WebSocket**：实时双向通信
- **Python**：游戏逻辑实现

### 前端技术栈
- **HTML5/CSS3**：界面设计
- **JavaScript**：客户端逻辑
- **WebSocket API**：实时通信

### 核心组件

#### Game类
- 游戏状态管理
- 玩家回合控制
- 胜负判定

#### Player类
- 玩家数据管理
- 财务状态跟踪
- 资产评估

#### Property类
- 地块属性管理
- 租金计算
- 抵押/赎回机制

#### Board类
- 游戏板创建
- 地块布局
- 移动逻辑

## 🌐 网络功能

### WebSocket通信
- 实时游戏状态同步
- 玩家行动广播
- 断线重连处理

### 连接管理
- IP地址限制（每IP限1连接）
- 连接历史记录
- 实时监控页面

### 安全特性
- CORS跨域支持
- 连接数限制
- 输入验证

## 🎨 界面特色

- **响应式设计**：适配不同屏幕尺寸
- **动画效果**：平滑的移动和交互动画
- **颜色区分**：每个玩家有独特的颜色标识
- **状态显示**：实时显示玩家金钱、资产等信息
- **操作提示**：清晰的操作按钮和提示信息

## 🔍 监控功能

访问 `http://localhost:8000/monitor` 查看：
- 当前在线玩家数量
- 连接历史记录
- 服务器状态信息
- 实时连接监控

## 🐛 故障排除

### 常见问题

1. **无法连接服务器**
   - 检查防火墙设置
   - 确认端口8000未被占用
   - 验证Python环境和依赖包

2. **游戏卡顿或断线**
   - 检查网络连接
   - 刷新浏览器页面
   - 重启服务器

3. **无法加入游戏**
   - 确认游戏未开始
   - 检查玩家数量是否已满
   - 验证IP连接限制

### 日志信息

服务器控制台会显示详细的连接日志：
```
[2024-06-29 10:30:15.123] CONNECT: Alice | 连接成功 | 连接数: 1
[2024-06-29 10:30:20.456] GAME_START: Alice | 游戏开始 | 连接数: 2
```

## 🤝 贡献指南

欢迎提交Issue和Pull Request！

### 开发环境设置
1. Fork项目
2. 创建功能分支
3. 提交代码
4. 发起Pull Request

## 📜 许可证

本项目采用MIT许可证 - 详见LICENSE文件

## 🎊 致谢

感谢所有为这个项目做出贡献的开发者们！

---

**快来体验这个有趣的多人大富翁游戏吧！** 🎮✨
